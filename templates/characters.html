{% extends "layout.html" %}
{% block title %}Characters | Tokyo Revengers{% endblock %}

{% block content %}
<div class="character-section">

  <!-- ðŸ” Filter & Search Bar -->
   <div class="filter-wrapper">
  <div class="filter-bar">
    <div class="filter-item">
      <label for="gangFilter"><strong>Filter by Gang:</strong></label>
      <select id="gangFilter">
        <option value="all">All</option>
        {% for gang in gangs %}
          <option value="{{ gang | lower }}">{{ gang }}</option>
        {% endfor %}
      </select>
    </div>
    
    <div class="filter-item" >
      <input type="text" id="searchInput" placeholder=" Search by name..." style="margin-left: 20px;">
    </div>
  </div>
</div>

  <!-- ðŸ§‘â€ðŸ¤â€ðŸ§‘ Character Cards -->
  <div class="card-grid" id="cardGrid" style="margin-top: 45px;">
    {% for char in characters %}
    <div class="card" data-gangs="{{ (char[4] if char[4] else 'Unaffiliated') | lower }}" data-name="{{ char[1] | lower }}">
      <img src="{{ url_for('static', filename='images/' + char[2]) }}"
           alt="{{ char[1] }}"
           loading="lazy"
           class="zoom-img"
           data-name="{{ char[1] }}">
      <h3>{{ char[1] }}</h3>
      <p>{{ char[3] }}</p>
      <small style="color:#888; font-size:0.8em;">Gangs: {{ char[4] if char[4] else "Unaffiliated" }}</small>
    </div>
    {% endfor %}
  </div>

  <!-- âŒ No Results Message -->
<!-- <p id="noResultsMessage" class="no-results">
  <i class="fas fa-user-slash"></i> &nbsp; No character name matched your search.
</p>
 -->
<p id="noResultsMessage" class="no-results">
  <i class="fas fa-search"></i> &nbsp; No character name matched your search.
</p>



  <!-- ðŸ§² Image Modal --> 
  <div id="imageModal" class="img-modal">
    <span class="close-zoom">&times;</span>
    <img class="modal-content-img" id="zoomedImg">
    <div id="caption" class="modal-caption-glow"></div>
  </div>

</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("imageModal");
    const modalImg = document.getElementById("zoomedImg");
    const captionText = document.getElementById("caption");
    const closeBtn = document.querySelector(".close-zoom");

    const gangFilter = document.getElementById("gangFilter");
    const searchInput = document.getElementById("searchInput");
    const cards = document.querySelectorAll(".card");
    const cardGrid = document.getElementById("cardGrid");
    const noResultsMessage = document.getElementById("noResultsMessage");

    // Zoom Image
    document.querySelectorAll(".zoom-img").forEach(img => {
      img.addEventListener("click", () => {
        modal.style.display = "flex";
        modalImg.src = img.src;
        captionText.textContent = img.getAttribute("data-name");
      });
    });

    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = (e) => {
      if (e.target === modal) modal.style.display = "none";
    };

    // Filter by Gang or Name
    function applyFilters() {
      const selectedGang = gangFilter.value.toLowerCase();
      const searchTerm = searchInput.value.toLowerCase();
      let visibleCount = 0;

      cards.forEach(card => {
        const gangData = card.getAttribute("data-gangs");
        const nameData = card.getAttribute("data-name");

        const gangMatch = selectedGang === "all" || gangData.includes(selectedGang);
        const nameMatch = nameData.includes(searchTerm);

        if (gangMatch && nameMatch) {
          card.style.display = "block";
          visibleCount++;
        } else {
          card.style.display = "none";
        }
      });

      // Show/hide "no results" message
      noResultsMessage.style.display = visibleCount === 0 ? "block" : "none";

      // Apply few-cards class
      if (visibleCount <= 2) {
        cardGrid.classList.add("few-cards");
      } else {
        cardGrid.classList.remove("few-cards");
      }
    }

    gangFilter.addEventListener("change", applyFilters);
    searchInput.addEventListener("input", applyFilters);
  });
</script>
{% endblock %}
